context: {{ requiredEnv "KUBECONTEXT" }}

helmDefaults:
  tillerNamespace: tiller
  tillerless: true
  atomic: true
  wait: true
  recreatePods: false

environments:
  default:
    values:
      - values/images.yml
    secrets:
      - values/secrets.yaml

releases:

# https://www.digitalocean.com/community/questions/hi-after-some-update-of-the-kubernetes-ltd-access-to-a-container-through-hostport-was-broken-i-assume-this-is-related-to-cilium-anyone-known-how-to-fix-that
- name: cilium-portmap
  namespace: kube-system
  chart: ./my-charts/cilium-portmap/

- name: traefik-auth-proxy
  namespace: traefik
  chart: ./my-charts/auth-proxy/
  values:
    - values/auth-proxy.yml.gotmpl
    - domain: traefik.patrician.gold
      upstream: traefik-dashboard:80

- name: traefik
  namespace: traefik
  chart: ./my-charts/traefik/
  recreatePods: true
  values:
    - values/traefik.yml.gotmpl

- name: matrix-synapse
  namespace: matrix
  chart: ./my-charts/matrix-synapse/
  verify: false
  values:
    - values/synapse.yml.gotmpl
    - values/common.yml.gotmpl

- name: matrix-riot
  namespace: matrix
  chart: ./my-charts/matrix-riot/
  verify: false
  values:
    - values/riot.yml.gotmpl

- name: murmur
  namespace: murmur
  chart: ./my-charts/murmur/
  recreatePods: true
  verify: false
  values:
    - values/murmur.yml.gotmpl
    - values/common.yml.gotmpl

- name: nginx-rtmp
  namespace: misc
  chart: ./my-charts/nginx-rtmp/
  verify: false
  recreatePods: true
  values:
    - values/nginx-rtmp.yml.gotmpl

- name: kube-state-metrics
  namespace: verdun
  chart: ./my-charts/kube-state-metrics/
  values:
    - image.tag: v1.6.0
    - kube-state-metrics-values.yml

- name: verdun-frontend
  namespace: verdun
  chart: ./my-charts/verdun-frontend/
  values:
    - imageTag: 2cb6121
    - common-values.yml.gotmpl
